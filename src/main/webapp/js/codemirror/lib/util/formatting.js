if(!CodeMirror.modeExtensions){CodeMirror.modeExtensions={}}CodeMirror.defineExtension("getModeExt",function(){var b=CodeMirror.resolveMode(this.getOption("mode")).name;var a=CodeMirror.modeExtensions[b];if(!a){throw new Error("No extensions found for mode "+b)}return a});CodeMirror.defineExtension("getModeExtAtPos",function(b){var a=this.getTokenAt(b);if(a&&a.state&&a.state.mode){return CodeMirror.modeExtensions[a.state.mode=="html"?"htmlmixed":a.state.mode]}else{return this.getModeExt()}});CodeMirror.defineExtension("commentRange",function(b,h,g){var d=this.getModeExtAtPos(this.getCursor());if(b){var a=this.getRange(h,g);this.replaceRange(d.commentStart+this.getRange(h,g)+d.commentEnd,h,g);if(h.line==g.line&&h.ch==g.ch){this.setCursor(h.line,h.ch+d.commentStart.length)}}else{var f=this.getRange(h,g);var e=f.indexOf(d.commentStart);var c=f.lastIndexOf(d.commentEnd);if(e>-1&&c>-1&&c>e){f=f.substr(0,e)+f.substring(e+d.commentStart.length,c)+f.substr(c+d.commentEnd.length)}this.replaceRange(f,h,g)}});CodeMirror.defineExtension("autoIndentRange",function(c,b){var a=this;this.operation(function(){for(var d=c.line;d<=b.line;d++){a.indentLine(d,"smart")}})});CodeMirror.defineExtension("autoFormatRange",function(f,e){var a=this.indexFromPos(f);var b=this.indexFromPos(e);var c=this.getModeExt().autoFormatLineBreaks(this.getValue(),a,b);var d=this;this.operation(function(){d.replaceRange(c,f,e);var j=d.posFromIndex(a).line;var h=d.posFromIndex(a+c.length).line;for(var g=j;g<=h;g++){d.indentLine(g,"smart")}})});CodeMirror.modeExtensions.css={commentStart:"/*",commentEnd:"*/",wordWrapChars:[";","\\{","\\}"],autoFormatLineBreaks:function(c,b,a){c=c.substring(b,a);return c.replace(new RegExp("(;|\\{|\\})([^\r\n])","g"),"$1\n$2")}};CodeMirror.modeExtensions.javascript={commentStart:"/*",commentEnd:"*/",wordWrapChars:[";","\\{","\\}"],getNonBreakableBlocks:function(f){var e=[new RegExp("for\\s*?\\(([\\s\\S]*?)\\)"),new RegExp("'([\\s\\S]*?)('|$)"),new RegExp('"([\\s\\S]*?)("|$)'),new RegExp("//.*([\r\n]|$)")];var c=new Array();for(var b=0;b<e.length;b++){var d=0;while(d<f.length){var a=f.substr(d).match(e[b]);if(a!=null){c.push({start:d+a.index,end:d+a.index+a[0].length});d+=a.index+Math.max(1,a[0].length)}else{break}}}c.sort(function(h,g){return h.start-g.start});return c},autoFormatLineBreaks:function(h,b,a){h=h.substring(b,a);var f=0;var g=new RegExp("(;|\\{|\\})([^\r\n])","g");var e=this.getNonBreakableBlocks(h);if(e!=null){var d="";for(var c=0;c<e.length;c++){if(e[c].start>f){d+=h.substring(f,e[c].start).replace(g,"$1\n$2");f=e[c].start}if(e[c].start<=f&&e[c].end>=f){d+=h.substring(f,e[c].end);f=e[c].end}}if(f<h.length-1){d+=h.substr(f).replace(g,"$1\n$2")}return d}else{return h.replace(g,"$1\n$2")}}};CodeMirror.modeExtensions.xml={commentStart:"<!--",commentEnd:"-->",wordWrapChars:[">"],autoFormatLineBreaks:function(h,f,a){h=h.substring(f,a);var j=h.split("\n");var g=new RegExp("(^\\s*?<|^[^<]*?)(.+)(>\\s*?$|[^>]*?$)");var d=new RegExp("<","g");var e=new RegExp("(>)([^\r\n])","g");for(var c=0;c<j.length;c++){var b=j[c].match(g);if(b!=null&&b.length>3){j[c]=b[1]+b[2].replace(d,"\n$&").replace(e,"$1\n$2")+b[3];continue}}return j.join("\n")}};CodeMirror.modeExtensions.htmlmixed={commentStart:"<!--",commentEnd:"-->",wordWrapChars:[">",";","\\{","\\}"],getModeInfos:function(k,a){var b=new Array();b[0]={pos:0,modeExt:CodeMirror.modeExtensions.xml,modeName:"xml"};var c=new Array();c[0]={regex:new RegExp("<style[^>]*>([\\s\\S]*?)(</style[^>]*>|$)","i"),modeExt:CodeMirror.modeExtensions.css,modeName:"css"};c[1]={regex:new RegExp("<script[^>]*>([\\s\\S]*?)(<\/script[^>]*>|$)","i"),modeExt:CodeMirror.modeExtensions.javascript,modeName:"javascript"};var g=(typeof(a)!=="undefined"?a:k.length-1);for(var f=0;f<c.length;f++){var d=0;while(d<=g){var e=k.substr(d).match(c[f].regex);if(e!=null){if(e.length>1&&e[1].length>0){var j=d+e.index+e[0].indexOf(e[1]);b.push({pos:j,modeExt:c[f].modeExt,modeName:c[f].modeName});b.push({pos:j+e[1].length,modeExt:b[0].modeExt,modeName:b[0].modeName});d+=e.index+e[0].length;continue}else{d+=e.index+Math.max(e[0].length,1)}}else{break}}}b.sort(function h(l,i){return l.pos-i.pos});return b},autoFormatLineBreaks:function(j,f,b){var a=this.getModeInfos(j);var d=new RegExp("^\\s*?\n");var k=new RegExp("\n\\s*?$");var g="";if(a.length>1){for(var e=1;e<=a.length;e++){var c=a[e-1].pos;var h=(e<a.length?a[e].pos:b);if(c>=b){break}if(c<f){if(h<=f){continue}c=f}if(h>b){h=b}var l=j.substring(c,h);if(a[e-1].modeName!="xml"){if(!d.test(l)&&c>0){l="\n"+l}if(!k.test(l)&&h<j.length-1){l+="\n"}}g+=a[e-1].modeExt.autoFormatLineBreaks(l)}}else{g=a[0].modeExt.autoFormatLineBreaks(j.substring(f,b))}return g}};